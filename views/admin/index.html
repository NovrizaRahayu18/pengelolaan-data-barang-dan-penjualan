<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Foto - Dashboard</title>
    <link rel="stylesheet" href="/admin/style/index.css">
    <link rel="icon" href="../images/logo.jpg" type="image/jpg">
    <style>
        
    </style>
</head>
<body>
    
<div class="container">

    <div class="navigasi">
        <div class="judul">
            <div class="gambar">
                <img src="../images/logo.jpg" alt="">
            </div>
            <h2>Family Foto</h2>
        </div>
        
        <div class="list">
            <ul>
                <li><a href="/">Dashboard</a></li>
                <li><a href="/admin/data-barang.html">Data Barang</a></li>
                <li><a href="/admin/data-barang-masuk.html">Data Barang Masuk</a></li>
                <li><a href="/admin/data-penjualan.html">Data Penjualan</a></li>
                <li><a href="#" onclick="handleLogout(event)">Logout</a></li>
            </ul>
        </div>
    </div>

    <div class="konten">
        <div class="isi-konten">
            <p class="welcome" id="nama_lengkap"></p>
            <p class="isi-welcome" id="role">Saat ini anda login dengan role </p>
        </div>

        <div class="bulan">
            <p class="judul-bulan" id="bulan-transaksi"> Transaksi Bulan Januari</p>
        </div>

        <div class="con-card">

            <div class="card-dash">
                <div class="card-title">
                    <h3> Total Transaksi</h3>
                    <h3 id="transaksi"></h3>
                </div>
            </div>
    
            <div class="card-dash">
                <div class="card-title">
                    <h3> Total Pendapatan</h3>
                    <h3 id="pendapatan"></h3>
                </div>
            </div>
    
        </div>
    </div>
</div>
<script>

const now = new Date();
    const bulan = now.getMonth();  // Angka bulan dimulai dari 0 (Januari = 0, Februari = 1, dst.)
    
    
    const namaBulan = [
        "Januari", "Februari", "Maret", "April", "Mei", "Juni", 
        "Juli", "Agustus", "September", "Oktober", "November", "Desember"
    ];

    document.getElementById('bulan-transaksi').textContent = `Transaksi Bulan ${namaBulan[bulan]}`;


function getCookieValue(cookieName) {
            const cookies = document.cookie.split('; ');
            
            for (let i = 0; i < cookies.length; i++) {
                const [key, value] = cookies[i].split('=');
                if (key === cookieName) {
                    return decodeURIComponent(value); 
                }
            }
            return null;
        }

        const username = getCookieValue('nama_lengkap');
        console.log(username)
    
        if (username) {
            document.getElementById('nama_lengkap').textContent = ` Selamat datang, ${username}`;
        } else {
            document.getElementById('nama_lengkap').textContent = 'Anonymous';
        }

        const role = getCookieValue('role');
        console.log(role)

        if (role) {
            document.getElementById('role').textContent =` Saat ini anda login dengan role ${role}`;
        } else {
            document.getElementById('role').textContent = 'Anonymous';
        }

async function handleLogout(event) {
    event.preventDefault();
    
    if (confirm("Apakah Anda yakin ingin logout?")) {
        try {
            const response = await fetch('/api/logout', {
                method: 'GET',
                credentials: 'include'
            });

            if (response.ok) {
                window.location.href = '/login';
            } else {
                alert('Gagal logout. Silakan coba lagi.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Terjadi kesalahan saat logout');
        }
    }
}

async function loadDashboardStats() {
    try {
        const response = await fetch('/api/dashboard-stats');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const stats = await response.json();

        // Transaksi Card
        const transaksiCard = document.getElementById('transaksi');
        transaksiCard.innerHTML = `
            <h3>${stats.totalTransaksi}</h3>
        `;

        // Pendapatan Card
        const pendapatanCard = document.getElementById('pendapatan');
        pendapatanCard.innerHTML = `
            <p>${formatRupiah(stats.totalPendapatan)}</p>
        `;
    } catch (error) {
        console.error('Error:', error);
    }
}

function formatRupiah(angka) {
    let number_string = angka.toString();
    let sisa = number_string.length % 3;
    let rupiah = number_string.substr(0, sisa);
    let ribuan = number_string.substr(sisa).match(/\d{3}/g);

    if (ribuan) {
        let separator = sisa ? '.' : '';
        rupiah += separator + ribuan.join('.');
    }

    return 'Rp ' + rupiah;
}


document.addEventListener('DOMContentLoaded', loadDashboardStats);
</script>

</body>
</html>